<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:HVO.Maui.RoofControllerV4.iPad.ViewModels"
             x:Class="HVO.Maui.RoofControllerV4.iPad.ConfigurationPage"
             x:DataType="viewModels:RoofControllerViewModel"
             BackgroundColor="#10131A">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="ConfigLabelStyle" TargetType="Label">
                <Setter Property="TextColor" Value="#ADB5BD" />
                <Setter Property="FontSize" Value="16" />
            </Style>

            <Style x:Key="ConfigEntryStyle" TargetType="Entry">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="TextColor" Value="#F8F9FA" />
                <Setter Property="PlaceholderColor" Value="#6C757D" />
                <Setter Property="BackgroundColor" Value="#1B212D" />
                <Setter Property="Margin" Value="0" />
                            <Setter Property="HeightRequest" Value="52" />
                            <Setter Property="HorizontalOptions" Value="FillAndExpand" />
            </Style>

            <Style x:Key="ConfigButtonStyle" TargetType="Button">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="BackgroundColor" Value="#0D6EFD" />
                <Setter Property="CornerRadius" Value="16" />
                <Setter Property="Padding" Value="24,16" />
                <Setter Property="HeightRequest" Value="56" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid Padding="32"
          RowSpacing="24"
          RowDefinitions="Auto,*">
        <VerticalStackLayout Spacing="12">
            <Label Text="Configuration"
                   FontSize="32"
                   FontAttributes="Bold"
                   TextColor="#F8F9FA" />
            <Label Text="Update connection details and safety thresholds for the roof controller client. Saved values persist on this device."
                   TextColor="#CED4DA"
                   FontSize="16"
                   LineHeight="1.35" />
        </VerticalStackLayout>

        <ScrollView Grid.Row="1">
            <Border BackgroundColor="#181C24"
                    StrokeThickness="0"
                    Padding="28">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="24" />
                </Border.StrokeShape>

                <VerticalStackLayout Spacing="24">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="API Base URL"
                               Style="{StaticResource ConfigLabelStyle}" />
                        <Entry Text="{Binding ConfigurationBaseUrl}"
                               Style="{StaticResource ConfigEntryStyle}"
                               Keyboard="Url"
                               Placeholder="https://observatory.local:7151/api/v4.0/" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="8">
                        <Label Text="Camera Stream URL"
                               Style="{StaticResource ConfigLabelStyle}" />
                        <Entry Text="{Binding ConfigurationCameraStreamUrl}"
                               Style="{StaticResource ConfigEntryStyle}"
                               Keyboard="Url"
                               Placeholder="http://camera.local/stream" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="8">
                        <Label Text="Status Poll Interval (s)"
                               Style="{StaticResource ConfigLabelStyle}" />
                        <Entry Text="{Binding ConfigurationStatusPollIntervalSeconds}"
                               Style="{StaticResource ConfigEntryStyle}"
                               Keyboard="Numeric"
                               Placeholder="3" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="8">
                        <Label Text="Clear Fault Pulse (ms)"
                               Style="{StaticResource ConfigLabelStyle}" />
                        <Entry Text="{Binding ConfigurationClearFaultPulseMs}"
                               Style="{StaticResource ConfigEntryStyle}"
                               Keyboard="Numeric"
                               Placeholder="250" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="8">
                        <Label Text="Request Retry Count"
                               Style="{StaticResource ConfigLabelStyle}" />
                        <Entry Text="{Binding ConfigurationRequestRetryCount}"
                               Style="{StaticResource ConfigEntryStyle}"
                               Keyboard="Numeric"
                               Placeholder="3" />
                    </VerticalStackLayout>

                    <VerticalStackLayout Spacing="8">
                        <Label Text="Failure Prompt Threshold"
                               Style="{StaticResource ConfigLabelStyle}" />
                        <Entry Text="{Binding ConfigurationFailurePromptThreshold}"
                               Style="{StaticResource ConfigEntryStyle}"
                               Keyboard="Numeric"
                               Placeholder="3" />
                    </VerticalStackLayout>

                    <BoxView HeightRequest="1" BackgroundColor="#1F2530" />

                    <VerticalStackLayout Spacing="8">
                        <Label Text="{Binding ConfigurationErrorMessage}"
                               TextColor="#DC3545"
                               FontSize="14"
                               IsVisible="{Binding HasConfigurationError}" />
                        <Label Text="{Binding ConfigurationSuccessMessage}"
                               TextColor="#198754"
                               FontSize="14"
                               IsVisible="{Binding HasConfigurationSuccess}" />
                    </VerticalStackLayout>

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="16" RowSpacing="0">
                        <Button Grid.Column="0"
                                Text="Save Configuration"
                                Command="{Binding SaveConfigurationCommand}"
                                Style="{StaticResource ConfigButtonStyle}" />
                        <ActivityIndicator Grid.Column="1"
                                           IsRunning="{Binding IsConfigurationSaving}"
                                           IsVisible="{Binding IsConfigurationSaving}"
                                           Color="#0DCAF0" />
                    </Grid>

                    <Label Text="Changes are stored locally in the device's app data folder. Restart the app to reload the updated configuration from disk."
                           TextColor="#ADB5BD"
                           FontSize="14"
                           LineHeight="1.3" />
                </VerticalStackLayout>
            </Border>
        </ScrollView>
    </Grid>

</ContentPage>
