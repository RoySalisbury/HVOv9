<svg xmlns="http://www.w3.org/2000/svg" width="1450" height="720" viewBox="0 0 1450 720">
  <style>
    .participant { fill: #f0f4ff; stroke: #4a6fa1; stroke-width: 2; }
    .title { font: bold 20px 'Segoe UI', sans-serif; fill: #102a43; }
    .label { font: 16px 'Segoe UI', sans-serif; fill: #102a43; }
    .note { font: italic 14px 'Segoe UI', sans-serif; fill: #52606d; }
    .lifeline { stroke: #9fb3c8; stroke-width: 2; stroke-dasharray: 8 6; }
    .arrow { stroke: #1f3d78; stroke-width: 2.5; fill: none; }
    .return { stroke: #2f855a; stroke-width: 2.5; stroke-dasharray: 6 6; fill: none; }
  </style>
  <rect width="1450" height="720" fill="#ffffff"/>
  <text x="725" y="40" text-anchor="middle" class="title">SkyMonitor Capture-to-Display Sequence</text>

  <!-- Participants -->
  <g transform="translate(80,80)">
    <rect width="140" height="50" class="participant" rx="8"/>
    <text x="70" y="32" text-anchor="middle" class="label">AllSkyCaptureService</text>
    <line x1="70" y1="50" x2="70" y2="580" class="lifeline"/>
  </g>

  <g transform="translate(240,80)">
    <rect width="140" height="50" class="participant" rx="8"/>
    <text x="70" y="32" text-anchor="middle" class="label">IExposureController</text>
    <line x1="70" y1="50" x2="70" y2="580" class="lifeline"/>
  </g>

  <g transform="translate(400,80)">
    <rect width="140" height="50" class="participant" rx="8"/>
    <text x="70" y="32" text-anchor="middle" class="label">ICameraAdapter</text>
    <line x1="70" y1="50" x2="70" y2="580" class="lifeline"/>
  </g>

  <g transform="translate(560,80)">
    <rect width="140" height="50" class="participant" rx="8"/>
    <text x="70" y="32" text-anchor="middle" class="label">RollingFrameStacker</text>
    <line x1="70" y1="50" x2="70" y2="580" class="lifeline"/>
  </g>

  <g transform="translate(720,80)">
    <rect width="140" height="50" class="participant" rx="8"/>
    <text x="70" y="32" text-anchor="middle" class="label">FrameFilterPipeline</text>
    <line x1="70" y1="50" x2="70" y2="580" class="lifeline"/>
  </g>

  <g transform="translate(880,80)">
    <rect width="140" height="50" class="participant" rx="8"/>
    <text x="70" y="32" text-anchor="middle" class="label">IFrameFilter Sequence</text>
    <line x1="70" y1="50" x2="70" y2="580" class="lifeline"/>
  </g>

  <g transform="translate(1040,80)">
    <rect width="140" height="50" class="participant" rx="8"/>
    <text x="70" y="32" text-anchor="middle" class="label">FrameStateStore</text>
    <line x1="70" y1="50" x2="70" y2="580" class="lifeline"/>
  </g>

  <g transform="translate(1200,80)">
    <rect width="140" height="50" class="participant" rx="8"/>
    <text x="70" y="32" text-anchor="middle" class="label">API / Blazor Client</text>
    <line x1="70" y1="50" x2="70" y2="580" class="lifeline"/>
  </g>

  <!-- Interactions -->
  <g>
    <!-- Service -> Exposure -->
    <line x1="150" y1="170" x2="310" y2="170" class="arrow"/>
    <polygon points="310,170 300,164 300,176" fill="#1f3d78"/>
    <text x="230" y="156" text-anchor="middle" class="label">CreateNextExposure()</text>

    <line x1="310" y1="210" x2="150" y2="210" class="return"/>
    <polygon points="150,210 160,204 160,216" fill="#2f855a"/>
    <text x="230" y="196" text-anchor="middle" class="label">ExposureSettings</text>

    <!-- Service -> Camera -->
    <line x1="150" y1="260" x2="470" y2="260" class="arrow"/>
    <polygon points="470,260 460,254 460,266" fill="#1f3d78"/>
    <text x="310" y="246" text-anchor="middle" class="label">CaptureAsync()</text>

    <line x1="470" y1="300" x2="150" y2="300" class="return"/>
    <polygon points="150,300 160,294 160,306" fill="#2f855a"/>
    <text x="310" y="286" text-anchor="middle" class="label">CameraFrame</text>

    <!-- Service -> Stacker -->
    <line x1="150" y1="350" x2="630" y2="350" class="arrow"/>
    <polygon points="630,350 620,344 620,356" fill="#1f3d78"/>
    <text x="380" y="336" text-anchor="middle" class="label">Accumulate(frame)</text>

    <line x1="630" y1="390" x2="150" y2="390" class="return"/>
    <polygon points="150,390 160,384 160,396" fill="#2f855a"/>
    <text x="380" y="376" text-anchor="middle" class="label">FrameStackResult</text>

    <!-- Service -> Pipeline -->
    <line x1="150" y1="440" x2="790" y2="440" class="arrow"/>
    <polygon points="790,440 780,434 780,446" fill="#1f3d78"/>
    <text x="470" y="426" text-anchor="middle" class="label">ProcessAsync(result)</text>

    <!-- Pipeline -> Filters looping -->
  <line x1="790" y1="480" x2="950" y2="480" class="arrow"/>
  <polygon points="950,480 940,474 940,486" fill="#1f3d78"/>
  <text x="870" y="466" text-anchor="middle" class="label">For each filter</text>
  <line x1="950" y1="520" x2="790" y2="520" class="return"/>
  <polygon points="790,520 800,514 800,526" fill="#2f855a"/>
  <text x="870" y="506" text-anchor="middle" class="label">Modified bitmap</text>
  <text x="870" y="550" text-anchor="middle" class="note">Filters run in configured order</text>

    <!-- Pipeline -> Service -->
    <line x1="790" y1="580" x2="150" y2="580" class="return"/>
    <polygon points="150,580 160,574 160,586" fill="#2f855a"/>
    <text x="460" y="566" text-anchor="middle" class="label">ProcessedFrame</text>

    <!-- Service -> Store -->
  <line x1="150" y1="620" x2="1110" y2="620" class="arrow"/>
  <polygon points="1110,620 1100,614 1100,626" fill="#1f3d78"/>
  <text x="650" y="606" text-anchor="middle" class="label">UpdateFrame(raw, processed)</text>

  <!-- Store -> API -->
  <line x1="1110" y1="660" x2="1270" y2="660" class="return"/>
  <polygon points="1270,660 1260,654 1260,666" fill="#2f855a"/>
  <text x="1190" y="646" text-anchor="middle" class="label">Latest frame on request</text>
  </g>
</svg>
